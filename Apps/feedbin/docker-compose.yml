name: feedbin
services:
  # Main Web Application
  feedbin-web:
    image: rachsharp/feedbin:latest
    container_name: feedbin-web
    ports:
      - "9292:9292"
    environment:
      - SECRET_KEY_BASE=use_a_long_random_string_here
      - DATABASE_URL=postgres://feedbin:feedbin@feedbin-db:5432/feedbin_production
      - REDIS_URL=redis://feedbin-redis:6379
      - ELASTICSEARCH_URL=http://feedbin-search:9200
      - MEMCACHED_HOSTS=feedbin-memcached:11211
    restart: unless-stopped
    depends_on:
      - feedbin-db
      - feedbin-redis
    x-casaos:
      ports:
        - container: "9292"
          description:
            en_us: "Web Interface"

  # Database
  feedbin-db:
    image: postgres:13-alpine
    container_name: feedbin-db
    environment:
      - POSTGRES_USER=feedbin
      - POSTGRES_PASSWORD=feedbin
      - POSTGRES_DB=feedbin_production
    volumes:
      - /DATA/AppData/feedbin/postgres:/var/lib/postgresql/data
    restart: unless-stopped

  # Background Worker (Refresher)
  feedbin-refresher:
    image: rachsharp/feedbin-refresher:latest
    container_name: feedbin-refresher
    environment:
      - REDIS_URL=redis://feedbin-redis:6379
      - DATABASE_URL=postgres://feedbin:feedbin@feedbin-db:5432/feedbin_production
    restart: unless-stopped

  # Cache & Queue
  feedbin-redis:
    image: redis:alpine
    container_name: feedbin-redis
    volumes:
      - /DATA/AppData/feedbin/redis:/data
    restart: unless-stopped

  # Search Engine
  feedbin-search:
    image: elasticsearch:2.4.6
    container_name: feedbin-search
    volumes:
      - /DATA/AppData/feedbin/elasticsearch:/usr/share/elasticsearch/data
    restart: unless-stopped

  # Temporary Cache
  feedbin-memcached:
    image: memcached:alpine
    container_name: feedbin-memcached
    restart: unless-stopped

x-casaos:
  architectures:
    - amd64
  main: feedbin-web
  author: rach-sharp
  category: Charlie
  description:
    en_us: "A fast, nice looking RSS reader. Note: Requires significant RAM (2GB+)."
  developer: Feedbin Team
  icon: https://cdn.jsdelivr.net/gh/homarr-labs/dashboard-icons/png/feedbin-light.png
  tagline:
    en_us: "A nice place to read on the web."
  title:
    en_us: Feedbin
  port_map: "9292"
